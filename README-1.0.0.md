# Installation

Visit <http://bav.malkusch.de/> and download the latest version or use [Composer](https://getcomposer.org/):

```json
{
    "require": {
        "malkusch/bav": "~1.0"
    }
}
```

# Autoloader

If you don't use composer's autoloader you have to include `bav/autoloader/autoloader.php`.
BAV uses the autoloader generated by [PHP-Autoloader](http://php-autoloader.malkusch.de/en/). 

```php
namespace malkusch\bav;

require_once __DIR__ . "/bav/autoloader/autoloader.php";

$bav = new BAV();
```


# Configuration

You can use BAV out of the box. BAV comes with a ready to play default
configuration (`DefaultConfiguration`):

* `UTF-8` encoding (if supported)

* `FileDataBackendContainer`. I.e. it uses binary search on the file from the Bundesbank.

* automatic installation. You don't have to call any installation
script. The container will download the Bundesbank file upon the first execution.

* update plan which triggers an E_USER_NOTICE if the Bundesbank file
is outdated.

You can define your own configuration by calling `ConfigurationRegistry::setConfiguration()`
or preferably creating the file `bav/configuration.php` which returns a `Configuration` object:

```php
namespace malkusch\bav;

$configuration = new DefaultConfiguration();

$pdo = new \PDO("mysql:host=localhost;dbname=test");
$configuration->setDataBackendContainer(new PDODataBackendContainer($pdo));

$configuration->setUpdatePlan(new AutomaticUpdatePlan());

return $configuration;
```

# Update

The Bundesbank releases new files for March, June, September and December.
BAV needs those new files. You have several possiblities to update bav:

## Script

Call `bin/bav-update.php`.

## Programmatically

```php
namespace malkusch\bav;

$bav = new BAV();
$bav->update();
```

## Automatic

Enable automatic updates with `AutomaticUpdatePlan` in your `bav/configuration.php`:

```php
namespace malkusch\bav;

$configuration = new DefaultConfiguration();
$configuration->setUpdatePlan(new AutomaticUpdatePlan());

return $configuration;
```

# Usage

You can use BAV with the api facade `BAV`:
```php
namespace malkusch\bav;

$bav = new BAV();
$bankID  = "10000000";
$account = "1234567890"

// check for a bank
var_dump(
    $bav->isValidBank($bankID)
);

// check for a bank account
var_dump(
    $bav->isValidBankAccount($bankID, $account)
);

// print the name of the bank
$agency = $bav->getMainAgency($bankID);
echo "{$agency->getName()} {$agency->getCity()}\n";
```
See also `docs/example.php`.


# Optional Dependencies

You may have:

* **CURL**: If you provide `bav/data/banklist.txt` you don't need CURL.

* **mbstring or iconv**: BAV works with unicode encoding. Your PHP must have support compiled
in to either the `mb_*` or the `iconv_*` functions. If these functions are
missing BAV works only with the ISO-8859-15 encoding.

* **PDO**: If you intend to use a DBS you need to use `PDODataBackendContainer`. 
`PDODataBackendContainer` needs a `PDO` support compiled in PHP.


# License and authors

This project is free and under GPL (see gpl.txt). So do what ever you want.
But it would be nice to leave a note about the authors.

The author of the original project which gave the idea to this project is
Bj√∂rn Wilmsmann. Responsable for this project is Markus Malkusch <markus@malkusch.de>.

[![Build Status](https://travis-ci.org/malkusch/bav.svg?branch=master)](https://travis-ci.org/malkusch/bav)